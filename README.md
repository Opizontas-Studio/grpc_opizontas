# gRPC Opizontas - åŠ¨æ€è·¯ç”±ç½‘å…³

ä¸€ä¸ªé«˜æ€§èƒ½çš„ gRPC ç½‘å…³æœåŠ¡ï¼Œæ”¯æŒåŠ¨æ€æœåŠ¡å‘ç°å’Œè¯·æ±‚è·¯ç”±ã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

1. **æœåŠ¡æ³¨å†Œä¸å‘ç°**
   - gRPC æœåŠ¡æ³¨å†Œ API
   - æœåŠ¡å¥åº·çŠ¶æ€ç®¡ç†
   - è‡ªåŠ¨è¿‡æœŸæœåŠ¡æ¸…ç†ï¼ˆ60ç§’è¶…æ—¶ï¼‰
   - çº¿ç¨‹å®‰å…¨çš„æœåŠ¡æ³¨å†Œè¡¨

2. **åŠ¨æ€è·¯ç”±æ ¸å¿ƒ**
   - gRPC å®¢æˆ·ç«¯è¿æ¥æ± ç®¡ç†
   - è‡ªåŠ¨åˆ›å»ºå’Œç¼“å­˜å®¢æˆ·ç«¯è¿æ¥
   - åŸºäºæœåŠ¡åçš„è·¯å¾„è§£æ
   - å®Œæ•´çš„è¯·æ±‚/å“åº”è½¬å‘é€»è¾‘

3. **é”™è¯¯å¤„ç†**
   - gRPC çŠ¶æ€ç æ ‡å‡†æ”¯æŒ
   - æœåŠ¡ä¸å¯ç”¨æ—¶çš„ä¼˜é›…é™çº§
   - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

### ğŸš§ å¾…å®Œå–„åŠŸèƒ½

1. **å®Œæ•´çš„è·¯ç”±é›†æˆ**
   - éœ€è¦ä¸ Tonic æœåŠ¡å™¨æ·±åº¦é›†æˆæˆ–ä½¿ç”¨åå‘ä»£ç†
   - æ”¯æŒæœªçŸ¥æœåŠ¡çš„åŠ¨æ€è½¬å‘

2. **è´Ÿè½½å‡è¡¡**
   - å¤šå®ä¾‹æœåŠ¡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥
   - å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»

3. **ç›‘æ§ä¸è§‚æµ‹**
   - è¯·æ±‚æŒ‡æ ‡å’Œæ€§èƒ½ç›‘æ§
   - åˆ†å¸ƒå¼è¿½è¸ªæ”¯æŒ

## å¿«é€Ÿå¼€å§‹

### å¯åŠ¨ç½‘å…³æœåŠ¡å™¨

```bash
cargo run
```

æœåŠ¡å™¨å°†åœ¨ `0.0.0.0:50051` å¯åŠ¨ï¼Œæä¾›ä»¥ä¸‹æœåŠ¡ï¼š

- **RegistryService**: æœåŠ¡æ³¨å†Œå’Œç®¡ç†

### æ³¨å†ŒæœåŠ¡ç¤ºä¾‹

ä½¿ç”¨ gRPC å®¢æˆ·ç«¯å‘ç½‘å…³æ³¨å†Œä¸€ä¸ªæœåŠ¡ï¼š

```rust
let request = RegisterRequest {
    address: "http://bot-service:50052".to_string(),
    services: vec!["PostService".to_string(), "UserService".to_string()],
};
```

### æµ‹è¯•æ³¨å†ŒåŠŸèƒ½

è¿è¡Œæµ‹è¯•ç¤ºä¾‹ï¼š

```bash
# å¯åŠ¨ç½‘å…³ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
cargo run

# è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯
cargo run --example test_registry
```

## æ¶æ„è®¾è®¡

```
å®¢æˆ·ç«¯è¯·æ±‚ -> gRPC ç½‘å…³ -> åŠ¨æ€è·¯ç”± -> ç›®æ ‡å¾®æœåŠ¡
                â†“
          æœåŠ¡æ³¨å†Œè¡¨
```

### æ ¸å¿ƒæ¨¡å—

- **`server.rs`**: ä¸»æœåŠ¡å™¨å¯åŠ¨å’Œé…ç½®
- **`services/registry_service.rs`**: æœåŠ¡æ³¨å†Œè¡¨å®ç°
- **`services/router_service.rs`**: åŠ¨æ€è·¯ç”±é€»è¾‘
- **`services/client_manager.rs`**: gRPC å®¢æˆ·ç«¯è¿æ¥æ± 

### æœåŠ¡å‘ç°æµç¨‹

1. å¾®æœåŠ¡å¯åŠ¨æ—¶å‘ç½‘å…³æ³¨å†Œè‡ªèº«
2. ç½‘å…³ç»´æŠ¤æœåŠ¡ååˆ°åœ°å€çš„æ˜ å°„
3. å®¢æˆ·ç«¯è¯·æ±‚é€šè¿‡æœåŠ¡åè·¯ç”±åˆ°å¯¹åº”æœåŠ¡
4. ç½‘å…³è‡ªåŠ¨ç®¡ç†è¿æ¥æ± å’Œå¥åº·çŠ¶æ€

## é…ç½®é€‰é¡¹

- **ç›‘å¬åœ°å€**: `0.0.0.0:50051` (åœ¨ `server.rs` ä¸­é…ç½®)
- **æœåŠ¡è¶…æ—¶**: `60ç§’` (åœ¨ `registry_service.rs` ä¸­é…ç½®)
- **æ¸…ç†é—´éš”**: `30ç§’` (åœ¨ `registry_service.rs` ä¸­é…ç½®)

## å¼€å‘è¯´æ˜

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹æŠ€æœ¯æ ˆï¼š

- **Tonic**: gRPC æ¡†æ¶
- **Tokio**: å¼‚æ­¥è¿è¡Œæ—¶
- **Tower**: æœåŠ¡æŠ½è±¡å’Œä¸­é—´ä»¶
- **http-body-util**: HTTP ä½“å¤„ç†å·¥å…·

### ç¼–è¯‘å’Œè¿è¡Œ

```bash
# å¼€å‘ç‰ˆæœ¬
cargo run

# ç”Ÿäº§ç‰ˆæœ¬
cargo build --release
./target/release/grpc_opizontas
```

### ä»£ç ç»“æ„

```
src/
â”œâ”€â”€ main.rs              # åº”ç”¨å…¥å£
â”œâ”€â”€ server.rs            # æœåŠ¡å™¨é…ç½®
â””â”€â”€ services/
    â”œâ”€â”€ mod.rs           # æ¨¡å—å£°æ˜
    â”œâ”€â”€ registry_service.rs    # æœåŠ¡æ³¨å†Œå®ç°
    â”œâ”€â”€ router_service.rs      # åŠ¨æ€è·¯ç”±å®ç°
    â””â”€â”€ client_manager.rs      # å®¢æˆ·ç«¯è¿æ¥æ± 
```

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼